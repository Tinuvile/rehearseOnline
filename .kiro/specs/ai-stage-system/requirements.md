# 需求文档

## 介绍

AI舞台系统是一个面向导演和演员的智能舞台管理平台。系统通过分析三维视频，提取音频、演员位置和移动轨迹，为舞台表演提供智能化的走位建议、灯光方案和音乐切换点推荐。导演可以使用该系统进行舞台调试和演示，演员可以通过系统熟悉舞台布局和走位。

## 需求

### 需求 1 - 视频分析与数据提取

**用户故事：** 作为导演，我希望上传三维舞台视频并自动提取演员位置、台词和时间信息，以便快速获得结构化的舞台数据。

#### 验收标准

1. 当用户上传三维视频文件时，系统应能够成功接收并开始处理
2. 当视频处理开始时，系统应提取音频并转换为带时间戳的文本
3. 当视频包含演员时，系统应识别人体关键点并重建3D位置信息
4. 当获得3D位置后，系统应将其转换为二维舞台坐标（顶视图）
5. 当处理完成时，系统应输出每帧/时间段的台词、演员位置和移动路径数据

### 需求 2 - 前端交互界面

**用户故事：** 作为导演和演员，我希望有一个直观的界面来查看和编辑台词、舞台布局、灯光和音乐，以便进行舞台排练和调整。

#### 验收标准

1. 当用户访问系统时，界面应显示台词编辑器、2D舞台视图、灯光面板和音乐面板四个主要部分
2. 当用户在台词编辑器中编辑时，系统应实时保存更改并与时间轴同步
3. 当用户在2D舞台视图中拖拽演员位置时，系统应更新演员坐标并显示移动路径
4. 当用户调整时间轴时，所有面板（台词、位置、灯光、音乐）应同步更新显示对应时间点的状态
5. 当用户预览时，系统应按时间轴顺序播放演员移动、台词、灯光和音乐变化

### 需求 3 - AI智能推荐

**用户故事：** 作为导演，我希望AI能够分析舞台空间和台词情感，自动生成走位建议、灯光方案和音乐切换点，以便提高排练效率和表演质量。

#### 验收标准

1. 当系统分析完视频数据后，AI应根据舞台空间布局生成合理的走位建议
2. 当AI分析台词情感时，系统应推荐相应的灯光颜色、亮度和变化时机
3. 当检测到台词情感或剧情转折点时，AI应建议音乐切换或音效添加的时机
4. 当用户查看AI建议时，系统应在专门的AI建议区域显示推荐内容
5. 当用户选择采用AI建议时，系统应将建议应用到对应的编辑面板中

### 需求 4 - 资源管理

**用户故事：** 作为导演，我希望能够上传和管理舞台布景、道具等资源，以便在系统中完整还原舞台环境。

#### 验收标准

1. 当用户上传布景文件时，系统应支持常见的3D模型格式（如OBJ、FBX等）
2. 当用户上传道具资源时，系统应将其分类存储并提供预览功能
3. 当用户在2D舞台视图中时，系统应显示已上传的布景和道具位置
4. 当用户拖拽布景或道具时，系统应实时更新其在舞台中的位置
5. 当系统生成走位建议时，AI应考虑现有布景和道具的位置约束

### 需求 5 - 数据同步与时间轴管理

**用户故事：** 作为用户，我希望台词、演员位置、灯光和音乐能够精确同步，以便准确控制舞台表演的每个细节。

#### 验收标准

1. 当系统处理视频时，所有数据（台词、位置、灯光、音乐）应与统一的时间轴对齐
2. 当用户修改任一元素的时间点时，系统应保持其他元素的相对时间关系
3. 当用户播放预览时，所有元素应按时间轴精确同步播放
4. 当用户暂停或跳转时间点时，所有面板应立即更新到对应时间的状态
5. 当用户导出数据时，系统应保持所有元素的时间同步关系

### 需求 6 - 3D预览支持

**用户故事：** 作为导演和演员，我希望能够在3D环境中预览舞台效果，以便更直观地理解空间关系和表演效果。

#### 验收标准

1. 当用户切换到3D预览模式时，系统应渲染三维舞台环境
2. 当3D预览播放时，演员模型应按照提取的轨迹数据移动
3. 当预览进行时，灯光效果应在3D环境中实时呈现
4. 当用户在3D视图中调整视角时，系统应提供平滑的相机控制
5. 当AI提供建议时，3D预览应能够显示建议的效果对比